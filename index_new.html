<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>URL Renderer</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html, body {
      height: 100%;
      overflow: hidden;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    .container {
      width: 100%;
      height: 100vh;
      position: relative;
      background: #f5f5f5;
    }
    
    .iframe-container {
      width: 100%;
      height: 100%;
      border: none;
      background: white;
    }
    
    .iframe-container iframe {
      width: 100%;
      height: 100%;
      border: none;
      display: block;
    }
    
    .loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      color: #666;
      font-size: 16px;
    }
    
    .loading-spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #007acc;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .error {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #ffebee;
      border: 1px solid #f44336;
      border-radius: 8px;
      padding: 20px;
      color: #c62828;
      text-align: center;
      max-width: 400px;
    }
    
    .placeholder {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #999;
      font-size: 18px;
      text-align: center;
    }
    
    .placeholder-icon {
      font-size: 48px;
      opacity: 0.5;
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="iframe-container" id="iframeContainer">
      <div class="loading" id="loading">
        <div class="loading-spinner"></div>
        <div>Loading content...</div>
      </div>
    </div>
  </div>

  <script>
    // Default URL if no parameter is provided
    const DEFAULT_URL = 'https://mashellhan.github.io/exceldash/dashboard_example.html';
    
    let currentIframe = null;
    
    // Get target URL from various sources
    function getTargetUrl() {
      // Priority 1: URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      let targetUrl = urlParams.get('targetUrl') || 
                     urlParams.get('url') || 
                     urlParams.get('src') || 
                     urlParams.get('source') || 
                     urlParams.get('link') ||
                     urlParams.get('target');
      
      // Priority 2: Hash fragment
      if (!targetUrl && window.location.hash) {
        const hash = window.location.hash.substring(1);
        if (isValidUrl(hash)) {
          targetUrl = hash;
        }
      }
      
      // Priority 3: Default URL
      return targetUrl || DEFAULT_URL;
    }
    
    // Validate URL
    function isValidUrl(string) {
      try {
        const url = new URL(string);
        return url.protocol === 'http:' || url.protocol === 'https:';
      } catch (_) {
        return false;
      }
    }
    
    // Show error message
    function showError(message) {
      const container = document.getElementById('iframeContainer');
      container.innerHTML = `
        <div class="error">
          <div style="font-weight: bold; margin-bottom: 10px;">‚ö†Ô∏è Error</div>
          <div>${message}</div>
        </div>
      `;
      console.error('Error:', message);
    }
    
    // Show placeholder
    function showPlaceholder(message) {
      const container = document.getElementById('iframeContainer');
      container.innerHTML = `
        <div class="placeholder">
          <div class="placeholder-icon">üåê</div>
          <div>${message}</div>
        </div>
      `;
    }
    
    // Load URL in iframe
    function loadUrl(url) {
      console.log('Loading URL:', url);
      
      if (!isValidUrl(url)) {
        showError(`Invalid URL: ${url}`);
        return;
      }
      
      const container = document.getElementById('iframeContainer');
      const loading = document.getElementById('loading');
      
      // Remove existing iframe
      if (currentIframe) {
        currentIframe.remove();
      }
      
      // Create new iframe
      currentIframe = document.createElement('iframe');
      currentIframe.src = url;
      currentIframe.style.display = 'none';
      
      // Set iframe attributes for better compatibility
      currentIframe.setAttribute('allow', 'autoplay; camera; microphone; geolocation');
      currentIframe.setAttribute('sandbox', 'allow-same-origin allow-scripts allow-forms allow-popups allow-modals allow-top-navigation-by-user-activation');
      
      // Handle iframe load
      currentIframe.onload = () => {
        loading.style.display = 'none';
        currentIframe.style.display = 'block';
        console.log('Content loaded successfully:', url);
      };
      
      // Handle iframe error
      currentIframe.onerror = () => {
        loading.style.display = 'none';
        showError(`Failed to load content: ${url}`);
      };
      
      // Handle load timeout
      const loadTimeout = setTimeout(() => {
        if (loading.style.display !== 'none') {
          loading.style.display = 'none';
          if (currentIframe.style.display === 'none') {
            currentIframe.style.display = 'block';
            console.log('Content loaded with potential issues:', url);
          }
        }
      }, 10000); // 10 second timeout
      
      // Clear timeout when iframe loads
      currentIframe.addEventListener('load', () => {
        clearTimeout(loadTimeout);
      });
      
      container.appendChild(currentIframe);
    }
    
    // Initialize app
    function initializeApp() {
      const targetUrl = getTargetUrl();
      
      console.log('Target URL:', targetUrl);
      console.log('Page URL:', window.location.href);
      console.log('URL Parameters:', Object.fromEntries(new URLSearchParams(window.location.search)));
      console.log('Hash Fragment:', window.location.hash);
      
      if (targetUrl) {
        loadUrl(targetUrl);
      } else {
        showPlaceholder('No URL specified');
      }
    }
    
    // Handle window resize
    window.addEventListener('resize', () => {
      if (currentIframe) {
        // Force iframe to recalculate its size
        currentIframe.style.height = '99%';
        setTimeout(() => {
          currentIframe.style.height = '100%';
        }, 1);
      }
    });
    
    // Start the app when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeApp);
    } else {
      initializeApp();
    }
  </script>
</body>
</html>
